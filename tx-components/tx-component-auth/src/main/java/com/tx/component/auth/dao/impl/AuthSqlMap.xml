<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="auth">

    <!-- 根据操作员id查询操作员拥有的权限引用项 -->  
    <select id="queryItemAuthRefListByOperId"
    	parameterType="String" 
    	resultType="com.tx.component.auth.model.AuthItemRefImpl">  
        <![CDATA[
			select distinct tar.authid,
			                tar.refid,
			                tar.authreftype,
			                tar.createdate,
			                tar.enddate,
			                tar.createoperid
			  from t_auth_authref tar
			 inner join wd_operator tu on tar.refid = tu.id
			                          and tar.authreftype = 'AUTHREFTYPE_OPERATOR'
			                          and tu.id = #{operId}
			 inner join wd_operator tu2 on tar.refid = tu2.id
			                           and tar.authreftype =
			                               'AUTHREFTYPE_OPERATOR_TEMP'
			                           and tar.enddate > sysdate
			                           and tu2.id = #{operId}
			 inner join (select tr.id
			               from t_auth_role tr, t_oper2role tor
			              where tor.roleid = tr.id
			                and tor.operid = #{operId}) tura on tar.refid = tura.id
        ]]>
    </select>
      
</mapper>  